<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sincronización Total - Canal TV</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        :root { --naranja-metal: linear-gradient(180deg, #ff8c00 0%, #e65100 100%); }
        body { background: #000; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; font-family: sans-serif; }
        .contenedor-tv { width: 100%; max-width: 900px; aspect-ratio: 16/9; background: var(--naranja-metal); padding: 5px; border-radius: 12px; position: relative; }
        .pantalla { width: 100%; height: 100%; background: #000; border-radius: 10px; overflow: hidden; position: relative; }
        
        /* Pestaña inteligente */
        .pestana-smart {
            position: absolute; top: 20%; right: 0; z-index: 100;
            display: flex; align-items: center; transition: 0.5s ease;
            transform: translateX(calc(100% - 15px));
        }
        .pestana-smart.abierta { transform: translateX(0); }
        .ceja { width: 15px; height: 60px; background: var(--naranja-metal); border-radius: 10px 0 0 10px; cursor: pointer; }
        .panel { background: rgba(10,10,10,0.95); padding: 15px; width: 170px; border-left: 2px solid #ff8c00; text-align: center; color: white; border-radius: 0 0 0 15px; }
        #reloj { font-size: 20px; font-weight: bold; color: #ffca28; display: block; margin: 10px 0; }
    </style>
</head>
<body>

<div class="contenedor-tv">
    <div class="pantalla">
        <div id="pestana" class="pestana-smart">
            <div class="ceja" onclick="document.getElementById('pestana').classList.toggle('abierta')"></div>
            <div class="panel">
                <span style="font-size: 10px; opacity: 0.7;">SIGUIENTE PROGRAMA EN:</span>
                <span id="reloj">00:00:00</span>
                <button onclick="forzarSincro()" style="background:var(--naranja-metal); border:none; color:white; padding:8px; width:100%; border-radius:5px; cursor:pointer; font-weight:bold; font-size:10px;">SINCRONIZAR VIVO</button>
            </div>
        </div>
        <video id="player" playsinline controls></video>
    </div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
<script>
    const playlist = [
        { url: "https://ia800900.us.archive.org/28/items/1.-riesgo-de-vuelo-2025-espanol_202506/1.Riesgo%20de%20vuelo%202025%F0%9F%87%AE%F0%9F%87%B9%20espa%C3%B1ol.mp4", dur: 7920 },
        { url: "https://ia600900.us.archive.org/28/items/1.-riesgo-de-vuelo-2025-espanol_202506/Intensa%20Mente%202.mp4", dur: 5760 },
        { url: "https://ia600900.us.archive.org/28/items/1.-riesgo-de-vuelo-2025-espanol_202506/C%C3%B3mo%20entrenar%20a%20tu%20drag%C3%B3n%202025.mp4", dur: 6000 }
    ];

    const player = new Plyr('#player', { autoplay: true, muted: true });
    // FECHA MAESTRA: 1 de Enero 2025.
    const T_MAESTRO = new Date("2025-01-01T00:00:00Z").getTime() / 1000;

    function forzarSincro() {
        const ahora = Math.floor(Date.now() / 1000);
        const transcurrido = ahora - T_MAESTRO;
        const total = playlist.reduce((a, b) => a + b.dur, 0);
        const enCiclo = transcurrido % total;

        let acum = 0;
        for (let v of playlist) {
            if (enCiclo < acum + v.dur) {
                const seek = enCiclo - acum;
                player.source = { type: 'video', sources: [{ src: v.url, type: 'video/mp4' }] };
                player.once('ready', () => {
                    player.currentTime = seek;
                    player.play();
                });
                break;
            }
            acum += v.dur;
        }
        
        // Pestaña aparece 5 seg y se va
        const p = document.getElementById('pestana');
        p.classList.add('abierta');
        setTimeout(() => p.classList.remove('abierta'), 5000);
    }

    // Actualiza el reloj de la pestaña cada segundo
    setInterval(() => {
        const ahora = Math.floor(Date.now() / 1000) - T_MAESTRO;
        const total = playlist.reduce((a, b) => a + b.dur, 0);
        const ciclo = ahora % total;
        let ac = 0;
        for (let v of playlist) {
            if (ciclo < ac + v.dur) {
                const queda = (ac + v.dur) - ciclo;
                const h = Math.floor(queda / 3600);
                const m = Math.floor((queda % 3600) / 60);
                const s = queda % 60;
                document.getElementById('reloj').innerText = `${h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
                break;
            }
            ac += v.dur;
        }
    }, 1000);

    // Sincroniza al cargar y al volver de otra pestaña
    window.addEventListener('load', forzarSincro);
    document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === "visible") forzarSincro();
    });
</script>
</body>
</html>
