<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Video con Sincronización</title>
    <style>
        /* Estilos básicos para el reproductor y botones */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .reproductor-container {
            width: 90%;
            max-width: 800px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        video {
            width: 100%;
            border-radius: 5px;
            margin: 15px 0;
        }

        .url-inputs {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="url"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-sincronizar {
            background-color: #ccc; /* Color original */
            color: white;
        }

        .btn-sincronizar.activo {
            background-color: #28a745; /* Color verde cuando hay URL */
        }

        .btn-sincronizar:active {
            background-color: #ccc; /* Vuelve a original al presionar */
            transform: scale(0.98);
        }

        .codigo-acceso {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="text"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-acceso {
            background-color: #007bff;
            color: white;
        }

        .mandos-administracion {
            display: none; /* Oculto por defecto */
            margin: 15px 0;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="reproductor-container">
        <h1>Reproductor de Video</h1>
        
        <!-- Campo de código de acceso -->
        <div class="codigo-acceso">
            <input type="text" id="codigoAcceso" placeholder="Ingresa código de acceso">
            <button class="btn btn-acceso" onclick="verificarCodigo()">Acceder a Mandos</button>
        </div>

        <!-- Mandos de administración (ocultos por defecto) -->
        <div class="mandos-administracion" id="mandosAdmin">
            <!-- Grupo para URL de video MP4 -->
            <div class="input-group">
                <input type="url" id="urlVideo" placeholder="URL del video MP4" required>
                <button class="btn btn-sincronizar" id="btnSincronizarVideo" onclick="sincronizarURL('video')" disabled>
                    Sincronizar Video
                </button>
            </div>

            <!-- Grupo para URL de publicidad -->
            <div class="input-group">
                <input type="url" id="urlPublicidad" placeholder="URL del video de publicidad" required>
                <button class="btn btn-sincronizar" id="btnSincronizarPublicidad" onclick="sincronizarURL('publicidad')" disabled>
                    Sincronizar Publicidad
                </button>
            </div>
        </div>

        <!-- Reproductor de video -->
        <video id="reproductorVideo" controls autoplay muted>
            Tu navegador no soporta el elemento de video.
        </video>
    </div>

    <!-- SDK de Firebase (asegúrate de usar tu propia configuración) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

    <script>
        // 1. CONFIGURACIÓN DE FIREBASE (REEMPLAZA CON TU PROPIA CONFIGURACIÓN)
        const firebaseConfig = {
            apiKey: "TU_API_KEY_AQUI",
            authDomain: "TU_AUTH_DOMAIN_AQUI",
            databaseURL: "TU_DATABASE_URL_AQUI",
            projectId: "TU_PROJECT_ID_AQUI",
            storageBucket: "TU_STORAGE_BUCKET_AQUI",
            messagingSenderId: "TU_MESSAGING_SENDER_ID_AQUI",
            appId: "TU_APP_ID_AQUI"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Elementos del DOM
        const reproductor = document.getElementById('reproductorVideo');
        const codigoAccesoInput = document.getElementById('codigoAcceso');
        const mandosAdmin = document.getElementById('mandosAdmin');
        const urlVideoInput = document.getElementById('urlVideo');
        const urlPublicidadInput = document.getElementById('urlPublicidad');
        const btnSincronizarVideo = document.getElementById('btnSincronizarVideo');
        const btnSincronizarPublicidad = document.getElementById('btnSincronizarPublicidad');

        // Código de acceso (el que mencionaste antes)
        const CODIGO_VALIDO = "7744118520";

        // 2. FUNCIÓN PARA VERIFICAR CÓDIGO DE ACCESO
        function verificarCodigo() {
            const codigo = codigoAccesoInput.value.trim();
            if (codigo === CODIGO_VALIDO) {
                mandosAdmin.style.display = "flex";
                alert("Acceso concedido a mandos de administración!");
            } else {
                alert("Código incorrecto. Intenta nuevamente.");
            }
        }

        // 3. FUNCIÓN PARA ACTIVAR BOTÓN CUANDO HAY URL
        function actualizarEstadoBoton(input, boton) {
            if (input.value.trim() !== "") {
                boton.classList.add('activo');
                boton.disabled = false;
            } else {
                boton.classList.remove('activo');
                boton.disabled = true;
            }
        }

        // Escuchar cambios en los inputs de URL
        urlVideoInput.addEventListener('input', () => {
            actualizarEstadoBoton(urlVideoInput, btnSincronizarVideo);
        });

        urlPublicidadInput.addEventListener('input', () => {
            actualizarEstadoBoton(urlPublicidadInput, btnSincronizarPublicidad);
        });

        // 4. FUNCIÓN DE SINCRONIZACIÓN DE URL
        function sincronizarURL(tipo) {
            let url, rutaDatabase;

            // Definir URL y ruta en Firebase según el tipo
            if (tipo === 'video') {
                url = urlVideoInput.value.trim();
                rutaDatabase = 'configuracion/video/url';
            } else if (tipo === 'publicidad') {
                url = urlPublicidadInput.value.trim();
                rutaDatabase = 'configuracion/publicidad/url';
            } else {
                alert("Tipo de URL no válido");
                return;
            }

            // Guardar en Firebase
            database.ref(rutaDatabase).set(url)
                .then(() => {
                    alert(`URL de ${tipo} sincronizada correctamente!`);
                    // Cargar la URL en el reproductor (solo para video principal)
                    if (tipo === 'video') {
                        reproductor.src = url;
                        reproductor.load();
                    }
                    // Limpiar input y volver botón a color original
                    if (tipo === 'video') urlVideoInput.value = "";
                    if (tipo === 'publicidad') urlPublicidadInput.value = "";
                    actualizarEstadoBoton(
                        tipo === 'video' ? urlVideoInput : urlPublicidadInput,
                        tipo === 'video' ? btnSincronizarVideo : btnSincronizarPublicidad
                    );
                })
                .catch(error => {
                    alert(`Error al sincronizar: ${error.message}`);
                });
        }

        // 5. CARGAR URL GUARDADA EN FIREBASE AL INICIAR
        window.addEventListener('load', () => {
            // Cargar URL de video principal
            database.ref('configuracion/video/url').once('value')
                .then(snapshot => {
                    const urlGuardada = snapshot.val();
                    if (urlGuardada) {
                        reproductor.src = urlGuardada;
                        reproductor.load();
                    }
                });

            // Cargar URL de publicidad (puedes agregar lógica para reproducirla antes del video)
            database.ref('configuracion/publicidad/url').once('value')
                .then(snapshot => {
                    const urlPublicidadGuardada = snapshot.val();
                    if (urlPublicidadGuardada) {
                        console.log("URL de publicidad guardada:", urlPublicidadGuardada);
                        // Aquí podrías agregar lógica para reproducir la publicidad primero
                    }
                });
        });
    </script>
</body>
</html>
